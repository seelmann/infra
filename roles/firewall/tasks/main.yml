---

- name: Install ufw
  apt: name={{item}} state=present
  with_items:
    - ufw

- name: Allow ssh traffic
  ufw: rule=limit port=ssh proto=tcp

- name: Enable logging
  ufw: logging=on

- name: Enable ufw
  ufw: state=enabled

- include: _forward.yml
  when: firewall is defined and ( firewall.forward is defined or firewall.nat is defined )

- include: _nats.yml
  when: firewall is defined and firewall.nat is defined

- include: _rules.yml
  when: firewall is defined and firewall.rules is defined

- meta: flush_handlers

