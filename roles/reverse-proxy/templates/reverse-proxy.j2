{% for item in reverse_proxy.passes %}
server {
  listen                  443;
  server_name             {{item.fqdn}};
  server_name_in_redirect off;
  ssl                     on;
  ssl_certificate         /etc/ssl/certs/{{item.fqdn}}.crt;
  ssl_certificate_key     /etc/ssl/private/{{item.fqdn}}.key;
  access_log              /var/log/nginx/{{item.fqdn}}.access.log;
  error_log               /var/log/nginx/{{item.fqdn}}.error.log;
  location / {
    proxy_pass            https://{{item.to}}/;
    proxy_set_header      X-Real-IP       $remote_addr;
    proxy_set_header      Host            $host;
    proxy_set_header      X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
server {
  listen                  80;
  server_name             {{item.fqdn}};
  access_log              /var/log/nginx/{{item.fqdn}}.access.log;
  error_log               /var/log/nginx/{{item.fqdn}}.error.log;
  location / {
    proxy_pass            http://{{item.to}}/;
    proxy_set_header      X-Real-IP       $remote_addr;
    proxy_set_header      Host            $host;
    proxy_set_header      X-Forwarded-For $proxy_add_x_forwarded_for;
  }
  #rewrite      ^ https://$server_name$request_uri?;
}

{% endfor %}
