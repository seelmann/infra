---
- hosts: all
  gather_facts: False
  vars:
    - ansible_sudo: no

  tasks:
    - include: tasks/check-single-host.yml

    - include: tasks/lxc-install-guest.yml ansible_sudo=yes
    - include: tasks/prepare-ansible-node.yml param_rootfs=/var/lib/lxc/{{inventory_hostname}}/rootfs param_delegate_to={{hypervisor}} ansible_sudo=yes
    - include: tasks/lxc-start-guest.yml ansible_sudo=yes

    - include: tasks/cleanup-known-hosts.yml
    - include: tasks/wait-for-ssh-up.yml

