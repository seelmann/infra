---
- hosts: all
  gather_facts: False
  vars:
    - ansible_sudo: no

  tasks:
    - name: Check for single host
      fail: msg="Single host check failed."
      when: "{{ play_hosts|length }} != 1"

    - name: Wait until SSH port is reachable
      #pause: seconds=5
      #local_action: wait_for port=22 host={{ansible_ssh_host}} timeout=15
      local_action: command nc -z {{ansible_ssh_host}} 22
      register: result
      until: result.rc == 0
      retries: 12
      delay: 10

    - name: Test SSH connection
      ping: 

